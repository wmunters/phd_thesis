\chapter{Optimal coordinated axial induction control of a wind-farm boundary layer}\label{ch:opt_induction}
This chapter discusses a first optimization study in which the methodology of previous chapter is applied. The current chapter is a continuation of earlier work on optimal coordinated axial induction control of wind farms presented in \cite{goit2015optimal} and \cite{goit2016optimal}. Here, we consider the optimal control of a wind farm with 72 turbines arranged in an aligned layout. Similarities and differences of the current study with the preceding works are highlighted throughout the chapter. The current chapter focusses on the case definition and observation of the optimal control results in terms of increased power extraction and differences in the wind-farm flow. Further, the influence of the wind-turbine response time defined in Sec. \ref{sec:meth_adm} on thrust loading variability and power extraction is investigated. An in-depth analysis of the control mechanisms of the current case, with the aim of gaining physical insights useful towards the development of practical controllers, will be presented later in Chapter \ref{ch:opt_analysis}. Since the current chapter focusses exclusively on axial induction control, yaw control is disabled by setting $\omega_{\text{max}} = 0^\circ$/s in \eqref{eq:costfunction}

The outline of the chapter is as follows. Section \ref{sec:opt_ind_setup} descibes the cases considered here, and elucidates numerical setup details. Section \ref{sec:opt_ind_results} discusses the results of the optimal control simulations. Concluding, Section \ref{sec:opt_ind_summ} summarizes the key aspects of this chapter. 

Parts of the content of this chapter have been published in the following articles:
\begin{itemize}
	\item \cite{munters2016effect}, ``Effect of wind turbine response time on optimal dynamic induction control of wind farms'', \emph{Journal of Physics: Conference Series} \textbf{753}, 052007
	\item \cite{munters2017optimal}, ``An optimal control framework for dynamic induction control of wind farms and their interaction with the atmospheric boundary layer'', \emph{Phil. Trans. R. Soc. A} \textbf{375}, 20160100
\end{itemize}

\section{Numerical setup and case description}\label{sec:opt_ind_setup}
In the current chapter, we consider a wind farm consisting of 72 turbines with hub height $z_h = 100$ m and a rotor diameter $D = 100$ m. Turbines are arranged in a $12 \times 6$ aligned pattern, and are spaced apart by 6 rotor diameters in axial and transversal directions. Firstly, the numerical setup for the simulation and optimization are elaborated. Afterwards, a set of control cases is defined. 

\subsubsection{Simulation setup}
The wind-farm boundary layer is simulated on a spatial domain of $10 \times 3.6 \times 1$ km$^3$, discretized using a standard numerical grid of $384 \times 192 \times 244$. A driving pressure gradient of $\partial_x p_\infty/\rho = 2.5 \times 10^{-4}$ m s$^{-2}$ results in a free-stream hub-height velocity slightly over 8 m s$^{-1}$. Figure \ref{fig:domain} illustrates a typical snapshot of the LES velocity field for the wind farm considered here. It can be seen from the figure that, starting from the second row, turbines are subjected to significantly lower velocities with increased variability. Moreover, it is shown that the LES allows to capture complex unsteady wake behavior, including meandering and turbulent entrainment, that can potentially be harnessed by the optimal control approach. Unsteady turbulent inflow conditions are the same for all cases, and are generated using the database precursor method from Sec. \ref{sec:inflow_CP} with a precursor simulation of identical dimensions as the main simulation. 

Wind farm operation is optimized over $N_A = 15$ prediction windows, resulting in a total time of $T_{tot} = N_AT_A = 30$ minutes. Time integration is performed using a constant timestep $\Delta t = 0.75$ s. We employ a prediction horizon of $T = 240$ s, and a flow advancement horizon of $T_A = T/2 = 120$ s. Based on numerical experiments, we retain $m = 5$ correction pairs for the BFGS Hessian updates. This proved to be an adequate parameter choice, both here and for a varied set of constrained problems in the CUTE collection \citep{bongartz1995cute}, as illustrated in \cite{byrd1995limited}. To limit the overall computational expense, we stop the optimization algorithm after $N_{it} = 60$ iterations. As further shown below, this leads to approximately 120 PDE evaluations (forward or adjoint), with a total walltime of about 24 hours per window on 320 Intel Ivy Bridge processor cores. Simulation and optimization parameters are summarized below in Table \ref{tab:setup}. The initial guess for the optimal controls is a steady $C_T' = 2$ for all turbines, corresponding to greedy Betz-optimal behavior (see discussion below). 

Simulations are initialized as follows: firstly, a fully-developed high-Reynolds number turbulent boundary layer is generated by simulating a perturbed logarithmic flow over a physical timespan of approximately 36 hours. Subsequently, wind turbines are inserted in the simulation, and the flow field is advanced in time until the effects of any wind-farm start-up transients have subsided in the main domain. This wind-farm boundary layer in statistically stationary state is used as initial condition for all simulation cases, and the corresponding time is set as $t = 0$~s in the remainder of this work.

\begin{figure}
	\centering
	\includegraphics[width=\linewidth]{chapters/philtrans_torque/figure6.eps}
	\caption{Large-eddy simulation streamwise velocity field for a 12 $\times$ 6 aligned wind farm. The black lines represent the turbine rotors. The black dashed line indicates the start of the fringe region for imposition of turbulent inflow conditions (see Sec. \ref{sec:meth_fringe}).}
	\label{fig:domain}
\end{figure}

\subsubsection{Control cases}

We consider a reference case (R) in which turbines greedily maximize individual power by setting their thrust coefficients to a steady Betz-optimal value $C_T' = 2$.  In addition, we define a set of optimal control cases in which thrust coefficient setpoints $\widehat{C}_T'$ is varied dynamically for each wind turbine. As shown in Fig. \ref{fig:under_overinductive}, momentum theory indicates that, for every desired $C_P < 16/27$ (i.e. the Betz limit), two possible $C_T'$ setpoints can be found: an \emph{underinductive} setpoint $C_T' < 2$, and an \emph{overinductive} setpoint $C_T' > 2$. By modifying $\ctmax$, we can hence define different control cases, based upon whether overinduction is allowed ($\ctmax = 3$, see Sec. \ref{sec:meth_adm}), or not ($\ctmax = 2$). Further, we aim to quantify the influence of smoothness of the thrust coefficient $\cthat$ on the resulting power gains and thrust force dynamics. This is done by selecting the WT response time as $\tau = 0$, $5$, or $30$ s for an instantaneous, fast, or slow response respectively. This is in contrast to previous work, which only considered instantaneous wind-turbine response \citep{goit2015optimal,goit2016optimal}. The response of the thrust coefficient $\cthat$ to a step variation in the setpoint $C_T'$ is illustrated in Fig. \ref{fig:cthat_ind}. Note however that control setpoints signals originating from the optimal control will be much more complex.  

\begin{figure}[t]
	\centering
	\includegraphics[width=0.75\linewidth]{figures/meth_ct_ctprime_cp2.eps}
	\caption{Illustration of reference, underinductive ($C_{T,\text{max}}' = 2$) and overinductive ($C_{T,\text{max}}' = 3$) cases on momentum theory-based power coefficient curve.\label{fig:under_overinductive}}
\end{figure}

\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{chapters/optimal_control_problem/figure3.eps}    
	\caption{Illustration of the response of the thrust coefficient $\widehat{C}_T'$ to a square wave variation in the control signal $C_T'$ for varying wind turbine response times $\tau$. \label{fig:cthat_ind}}
\end{figure}
 
Summarizing, this hence leads to the definition of 6 optimal axial induction control cases: a set of overinductive cases and a set of underinductive cases, both of which contain an instantaneous, fast, and slow response case. Optimal control cases are denoted as C<X>t<Y>, where X and Y represent $\ctmax$ and $\tau$ respectively, e.g. C3t30 for the case with $\ctmax=3$ and $\tau=30$ s. The definition of the control cases is summarized in Table \ref{tab:setup}.

%------------------------------------------
% Table setup parameters
%------------------------------------------
%\begin{table}[p]
\begin{table}[t]	
	\caption{Setup parameters}\label{tab:setup}
	\centering
	\begin{tabular}{ll}
		\hline \\
		\textbf{Simulation parameters} & \\
		Domain size  & 			$L_x \times L_y \times H = (9 \boldsymbol{+1}) \times 3.6 \times 1$ km$^3$  \\ 
		Driving pressure gradient  & 	$ \partial_x p_\infty = 2.5 \times 10^{-4}$ m s$^{-2}$  \\ 
		Turbine dimensions  &  $D = 0.1H = 100$ m, \quad $z_h = 0.1H = 100$ m\\ 
		Turbine spacing  &  $S_x = 6D, \quad S_y = 6D$\\
		Windfarm layout & $N_t = 72 $ turbines = 12 rows $\times$ 6 columns \\ 
		Surface roughness  &  $z_0 = 10^{-4}H = 0.1$m\\ 
		Grid size & $N_x \times N_y \times N_z = 384 \times 256 \times 144$\\
		Cell size & $\Delta_x \times \Delta_y \times \Delta_z = 26 \times 14 \times 6.9$ m$^3$\\
		Time step & $\Delta t = 0.75$ s\\		
		&\\
		\textbf{Optimization parameters} & \\ 
		Optimization method			& L-BFGS-B \\
		Hessian correction pairs 	& $m = 5$ \\
		BFGS iterations 			& $N_{it} = 60$ ($\approx 120$ PDE) \\
		Optimization time window					& $T = 240$ s\\
		Flow advancement time window & $T_A = 120$ s\\
		Total operation time         & $T_{tot} = 1800$ s (15 windows)\\
		&\\
		\textbf{Cases} & \\
		R			& $C_T' = 2$\\
		C3t0		& $0 \leq C_T' \leq 3$  \quad   $\tau = 0$ s (overinductive)\\
		C3t5		& $0 \leq C_T' \leq 3$  \quad   $\tau = 5$ s (overinductive)\\
		C3t30		& $0 \leq C_T' \leq 3$  \quad   $\tau = 30$ s (overinductive)\\
		C2t0		& $0 \leq C_T' \leq 2$  \quad   $\tau = 0$ s (underinductive)\\			C2t5		& $0 \leq C_T' \leq 2$  \quad   $\tau = 5$ s (underinductive)\\
		C2t30		& $0 \leq C_T' \leq 2$  \quad   $\tau = 30$ s (underinductive)\\		
		\hline 
	\end{tabular} 
\end{table}

\section{Optimal coordinated control results}
This section discusses the optimization results using the setup mentioned above. Firstly, we put the obtained results into context by investigating the convergence behavior and sensitivity to the initial control guess $\bs{\varphi}_0$. Thereafter, Sec. \ref{sec:opt_ind_energy} discusses the gains in energy extraction achieved by the optimal control simulations. Subsequently, Sec. \ref{sec:opt_ind_dyn} illustrates the turbine dynamics on the level of control settings and thrust forces in order to accomplish these gains. Lastly, Sec. \ref{sec:opt_ind_flow} depicts the differences in flow field statistics between the reference and controlled cases.

Figure \ref{fig:window_opt} illustrates the convergence behavior for all optimal control simulations. From Figure \ref{fig:window_opt}a it can be seen that, for most cases, the amount of PDE evaluations is only slightly higher than twice the amount of BFGS iterations $N_{it}$, illustrating that the optimization algorithm mostly takes steps with unit length, and only rarely has to resort to a line-search when $\alpha$ does not satisfy the Wolfe conditions introduced in Sec. \ref{sec:problem_optimization}. Note that case C2t30 achieved convergence after 120 iterations, with a large increase in PDE simulations in the preceding iterations. This indicates that, upon approaching convergence, inconsistencies between the gradient obtained from the continuous adjoint approach and the actual cost functional gradient are making it harder to satisfy the Wolfe conditions, and more line searches are needed. This behavior also starts to show in the later iterations of the other cases. Figure \ref{fig:window_opt}b depicts the relative improvement in the cost function within an optimization window in terms of the amount of iterations. It can be seen that, after 60 iterations, the improvement rate of the cost function significantly dimishes. Figure \ref{fig:window_opt}c shows the cost functional as a function of PDE evaluations. The circle markers indicate the datapoints for which $N_{it} = 60$. The figure shows that all cases achieve reasonable convergence for the chosen iteration limit, i.e. further improvements of the cost functional are minimal. These observations justify terminating the optimization after 60 iterations for the cases described in this chapter. 

\begin{figure}
	\centering
	\includegraphics[width=0.9\linewidth]{chapters/philtrans_torque/figure11.eps}
	\caption{Typical convergence behavior within an optimization window. (Legend: \legendnoref) \label{fig:window_opt}}
\end{figure}
	
Given the non-convexity of the Navier--Stokes constrained optimization problems considered here, the cost functional landscape is expected to be characterized by a multitude of local optima. Figure \ref{fig:initial_conditions} shows the cost functional and a subset of the optimized controls for different starting points $\blds{\varphi}_0$, i.e. a greedy control case on the one hand, for which all turbines operate Betz-optimal at $\blds{\varphi}_0 = [2 \ \ 2 \ \dots \ 2]$, and a case with $\blds{\varphi}_0 = [1.33 \ \ 1.33 \ \dots \ 1.33]$ (see, e.g., \cite{calaf2010large, goit2015optimal}) on the other hand. Figure \ref{fig:initial_conditions}a illustrates cost functional decrease in terms of BFGS iterations. It can be seen that, although the choice of initial conditions has an influence on the power extraction, the relative order of which conditions yield better results is not uniform across all cases. Figure \ref{fig:initial_conditions}b shows the optimized controls for the first row of the wind farm after 1, 60, 120, and 180 iterations. Although some regions of the controls correspond between both initial conditions, mainly at the start of the optimization window the controls differ significantly. Since the overall energy extraction seems only modestly dependent on the initial condition, the greedy control with $\varphi_0 = 2$ is a suitable starting point for wind-farm optimal control.

\begin{figure}[ht!]
	\centering
	\includegraphics[width=\linewidth]{chapters/philtrans_torque/figure13.eps}	
	\caption{Sensitivity of optimization to initial conditions. \emph{a):} Cost functional as a function of BFGS iterations for a single window. ($\square$: $\blds{\varphi}_0 = 2$, $\lozenge$: $\blds{\varphi}_0 = 1.33$, \legendnoref ). \emph{b):} Optimized controls for a front row turbine at various iterations. (Black: $\blds{\varphi}_0 = 2$, Gray: $\blds{\varphi}_0 = 1.33$). \label{fig:initial_conditions}} 
\end{figure}


\subsection{Wind-farm energy extraction}\label{sec:opt_ind_energy}

Figure \ref{fig:bar_and_row} depicts the energy extraction of the optimally controlled wind farms normalized by the reference case. The energy extraction is integrated starting from the second optimization window, since the optimized wind farms are still in a transient phase during the first window. It is shown in Figure \ref{fig:bar_and_row}a that all cases, except for the most restrictive case C2t30, achieve significant energy gains ranging between 8 and 21\%. This illustrates the potential of dynamic coordinated control approaches over greedy individual control. As can be expected, decreasing flexibility with regards to $C_T'^{max}$ and $\tau$ reduces the margins for increased power extraction. It is worth noting that the slow-response overinductive case C3t30 achieves power gains close to the underinductive fast-response cases C2t0 and C2t5. This observation is promising for the eventual actual roll-out of dynamic wind farm controllers, as it shows that fast temporal variations in turbine control settings, with associated detrimental effects on turbine structural loading, are not a prerequisite for significant improvements in power extraction. The error bars in the figure indicate 2 standard deviations from the sampled mean. Error estimates are within $\pm 1.2$\% points for all cases except C3t0, for which $\pm 1.9$\% points is observed. The variances of relative energy gains are estimated using variances and covariances defined on the optimization window level, as further elaborated in Appendix \ref{ch:app_variance}. In Figure \ref{fig:bar_and_row}b it is shown that energy extraction is increased in every downstream row by slightly downrating the first row for all cases except C3t30. Moreover, the first row aside, the last row extracts the most energy for all cases, since it does not have to take into account any downstream neighbors. Note that the cases considered here feature significantly larger energy gains than the comparable case in \cite{goit2016optimal}, for which an increase in energy extraction of approximately 6\% was reported. This fact directly results from the updates to the optimization framework discussed throughout this thesis: the combination of the improved solver parallelization as discussed in Sec. \ref{sec:meth_par} with the updated quasi-Newton optimizer from Sec. \ref{sec:problem_optimization} allow us to run more cases with better convergence within a reasonable time to solution. 

\begin{figure}
	\centering
	\includegraphics[width=\linewidth]{chapters/philtrans_torque/figure8.eps}
	\caption{Energy extraction of optimally controlled wind farms $E_O$ normalized by greedy reference case $E_R$. \emph{a) } Total energy extraction. Error bars indicate confidence intervals of $\pm 2$ standard deviations. \emph{b) } Energy extraction per row, normalized by first row of reference case. \legend \label{fig:bar_and_row}}
\end{figure}

\subsection{Wind-farm dynamics}\label{sec:opt_ind_dyn}
Figure \ref{fig:time_control_and_time_power} illustrates the dynamic behavior for all cases over 30 minutes of operation time. Figures \ref{fig:time_control_and_time_power}a and \ref{fig:time_control_and_time_power}c depict a front-row turbine thrust coefficient setpoint $C_T'$ and its time-filtered counterpart $\widehat{C}_T'$ for the overinductive and underinductive cases respectively. It can be seen from these figures that $C_T'$ varies wildly between its upper and lower bound in response to the turbulent dynamics of the boundary layer, and that time-filtering greatly reduces temporal variability in $\widehat{C}_T'$. Figures \ref{fig:time_control_and_time_power}b and \ref{fig:time_control_and_time_power}d show the total power extraction normalized by reference power. We see for all cases that optimal control leads to an increase in temporal variations of extracted power, and that time-filtering significantly reduces potentially harmful variability on shorter timescales. The periodic variations on longer timescales that can be observed for all cases except C2t30 are caused by finite-horizon optimization effects.
We note that C2t30 hardly differs from the reference case R, with $\widehat{C}_T' \approx 2$ for virtually all turbines throughout the entire time horizon. This indicates that, for underinductive control of the considered wind-farm setup, variations on shorter timescales are essential for significant power increase through optimal control. Further analysis of the optimized controls and the physical mechanisms behind increasing power extraction will be presented in Chapter \ref{ch:opt_analysis}. 

\begin{figure}
	\centering
	\includegraphics[width=0.93\linewidth]{chapters/philtrans_torque/dynamics.eps}
	\caption{Temporal behavior of optimally controlled wind farms. 
		\emph{Left (a,c): } Thrust coefficient of a first row wind turbine. Colors: setpoint coefficient $C_T'$, Grey: time-filtered coefficient $\widehat{C}_T'$. \emph{Right (b,d): } Aggregate power extraction normalized by time average of reference power extraction. \emph{Top (a,b): } $C_T'^{max}=3$. \emph{Bottom (c,d): } $C_T'^{max} = 2$.}% \legendtauref }	\label{fig:time_control_and_time_power}
\end{figure}

Figure \ref{fig:thrust} shows the dynamic behavior of the thrust force $f_t$ for a turbine $t$ in row 6 of the wind farm, where turbulence levels at hub height approach a fully-developed state. Figure \ref{fig:thrust}a illustrates the time series of $f_t$, normalized by the time-averaged values of the same turbine in the reference case. It can be seen that case C3t0 exhibits high frequency force variations and peak forces regularly exceeding values twice as large as the time average reference $\overline{f}_{t,R}$. Such high-frequency, high-amplitude load cycling can significantly reduce wind-turbine lifetime through fatigue, and is hence to be avoided. Cases C3t5 and C3t30 show that increasing response time $\tau$ not only filters out high frequency force fluctuations, but also leads to a reduction of the largest force amplitudes for this wind turbine. A further decrease in amplitudes is achieved by reducing $C_T'^{max}$ to 2. Figure \ref{fig:thrust}b shows the power spectra of the time series illustrated in \ref{fig:thrust}a. Low frequency behavior ($\leq 10^{-2}$ Hz) is similar for all cases and tends to a --1 slope, indicating that the slowest force variations are governed by the background atmospheric dynamics. Around $10^{-2}$ Hz, a small --5/3 range is observed. At higher frequencies, a slope between --3 and --4 characterizes the controlled cases,  while the static reference case decays much more quickly. In this range, the turbine response time to variations in control setpoint directly translates to the frequency content of the thrust force enacted by the turbine. It is important to note that, not only should fatigue be taken into account when considering additional cyclic turbine loading due to dynamic wind farm control, also natural frequencies of relevant deformation modes should be avoided at all cost. For example, the natural frequency associated with the tower fore-aft deformation mode of the NREL 5 MW turbine is approximately 0.3 Hz \citep{jonkman2009definition}. It can be seen from Figure \ref{fig:thrust} that cases C3t0 and C2t0 show significant spectral energy in this range. These results indicate that a detailed analysis of turbine structural loading, through the addition of a multi-physics aero-elastic turbine model in the governing equations is an essential step towards actual rollout of fast-response dynamic wind farm controllers. This is an interesting opportunity for future research.

\begin{figure}
	\includegraphics[width=\textwidth]{chapters/philtrans_torque/thrust_forces.eps}
	\caption{Dynamic behavior of thrust force $f_t$ for a 6th row turbine. \emph{a)} Time series of thrust force, normalized by time-averaged reference thrust. \emph{b) } Power spectra $\Phi_f$ of normalized thrust force, averaged over columns. \legend \label{fig:thrust}}
\end{figure}




\subsection{Wind-farm flow field statistics}\label{sec:opt_ind_flow}

	Here, we discuss the differences in time-averaged flow field statistics between the reference case and the optimal control. For sake of brevity and readability, we focus on the four cases with the highest power extraction, i.e. the overinductive cases C3t0, C3t5, and C3t30, and the instantaneous underinductive case C2t0. Moreover, the flow field is averaged over six spanwise domain slabs, associated with each of the turbine columns. Firstly, axial velocity is discussed as the main driver behind wind-farm power extraction. Thereafter, turbulence kinetic energy, and transversal and vertical transport of axial momentum are illustrated. 

	\subsubsection{Axial velocity}

	Figures \ref{fig:opt_ind_top_u} and \ref{fig:opt_ind_side_u} respectively show planviews at hub height and sideviews through the rotor
	centerline of time-averaged axial velocity $\overline{\widetilde{u}}_x$. It can be seen from both figures that, for all cases, downstream
	turbines are subjected to higher incoming flow velocities. The overinductive cases show a larger drop in $\overline{\widetilde{u}}_x$ over the
	rotor disk, most notably in the first row turbines, indicating relatively deeper wakes with enhanced recovery before hitting the next row of
	turbines. In contrast, this larger drop is not observed for the underinductive case C2t0: the lower average $\cthat$ causes shallower averaged
	wakes throughout the entire wind farm. Further, it can be observed that, for the overinductive cases, the axial velocity in the flow above and
	besides the wind turbine column is reduced, indicating that these regions are depleted of mean-flow kinetic energy. This is further discussed
	below. This reduction is only visible to a much lesser extent in the underinductive case C2t0.
	
	% TOPVIEW U
	\begin{figure}
		\centering
		\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/topview_u.eps}
		\caption{Planview of time-averaged axial velocity $\overline{\widetilde{u}}_x$ at hub height. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = \overline{\widetilde{u}}_{x,\text{opt}} - \overline{\widetilde{u}}_{x,\text{R}}$  \label{fig:opt_ind_top_u}}
	\end{figure}

	% SIDEVIEW U
	\begin{figure}
		\centering
		\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/sideview_u.eps}
		\caption{Sideview of time-averaged axial velocity $\overline{\widetilde{u}}_x$ in turbine centerline plane. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = \overline{\widetilde{u}}_{x,\text{opt}} - \overline{\widetilde{u}}_{x,\text{R}}$  \label{fig:opt_ind_side_u}}
	\end{figure}	
	
	
	\subsubsection{Kinetic energy}
%
%------------------------------------------
% Figure wake deficit and TKE
%------------------------------------------
		\begin{figure}
			\centering
			\includegraphics[width=\textwidth]{chapters/philtrans_torque/u_tke2.eps}
			\caption{Time-averaged streamwise velocity $\overline{\tilde{u}_1}$ (\emph{Top }(a,b)) and turbulence kinetic energy $k = (\overline{\tilde{u}_x' \tilde{u}_x'} + \overline{\tilde{u}_y' \tilde{u}_y'} + \overline{\tilde{u}_z' \tilde{u}_z'})/2$ (\emph{Bottom }(c,d)) through rotor centerlines ($z = z_h, y = y_h$) as a function of streamwise distance along turbine column. \emph{Left} (a,c): $C_T'^{max} = 3$. \emph{Right} (b,d): $C_T'^{max} = 2$. \legendtauref	\label{fig:u_tke}}
		\end{figure}



	
		% SIDEVIEW KE
		\begin{figure}
			\centering
			\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/sideview_ke_side.eps}
			\caption{Sideview of mean-flow kinetic energy $\overline{\widetilde{u}}_x$ in turbine centerline plane. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = \overline{\widetilde{u}}_{x,\text{opt}} - \overline{\widetilde{u}}_{x,\text{R}}$  \label{fig:opt_ind_top_u}}
		\end{figure}

		% TOPVIEW TKE	
		\begin{figure}
			\centering
			\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/topview_tke.eps}
			\caption{Planview of time-averaged turbulence kinetic energy $k = \frac{1}{2}(\overline{\widetilde{u}_x'\widetilde{u}_x'} + \overline{\widetilde{u}_y'\widetilde{u}_y'} + \overline{\widetilde{u}_z'\widetilde{u}_z'})$ at hub height. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = k_{\text{opt}} - k_{\text{R}}$  \label{fig:opt_ind_top_u}}
		\end{figure}
	
		% SIDEVIEW U
		\begin{figure}
			\centering
			\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/sideview_tke_side.eps}
			\caption{Sideview of time-averaged turbulence kinetic energy $k = \frac{1}{2}(\overline{\widetilde{u}_x'\widetilde{u}_x'} + \overline{\widetilde{u}_y'\widetilde{u}_y'} + \overline{\widetilde{u}_z'\widetilde{u}_z'})$ in turbine centerline plane. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = k_{\text{opt}} - k_{\text{R}}$  \label{fig:opt_ind_top_u}}
		\end{figure}

	\subsubsection{Transversal momentum transport}
	
		% TOPVIEW UVM
		\begin{figure}
			\centering
			\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/topview_uvm.eps}
			\caption{Planview of mean-flow transversal transport of axial momentum $\overline{\widetilde{u}}_x~ \overline{\widetilde{u}}_y$ at hub height. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = (\overline{\widetilde{u}}_x~ \overline{\widetilde{u}}_y)_{\text{opt}} - (\overline{\widetilde{u}}_x~ \overline{\widetilde{u}}_y)_{\text{R}}$. Sign convention for transversal component $v$: upwards motion in figure = positive. \label{fig:opt_ind_top_u}}
		\end{figure}
	
		% TOPVIEW UVturb
		\begin{figure}
			\centering
			\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/topview_uv.eps}
			\caption{Planview of turbulent transversal transport of axial momentum $\overline{\widetilde{u}_x' \widetilde{u}_y'}$ at hub height. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = \overline{\widetilde{u}_x' \widetilde{u}_y'}_{\text{opt}} - \overline{\widetilde{u}_x' \widetilde{u}_y'}_{\text{R}}$  \label{fig:opt_ind_top_u}}
		\end{figure}	
	
	\subsubsection{Vertical momentum transport}

	% TOPVIEW UWM
	\begin{figure}
		\centering
		\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/sideview_uwm.eps}
		\caption{Sideview of mean-flow top-down transport of axial momentum $- \overline{\widetilde{u}}_x~ \overline{\widetilde{u}}_z$ in turbine centerline plane. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = (- \overline{\widetilde{u}}_x~ \overline{\widetilde{u}}_z)_{\text{opt}} - (- \overline{\widetilde{u}}_x~ \overline{\widetilde{u}}_z)_{\text{R}}$. Sign convention: downward transport = positive. \label{fig:opt_ind_top_u}}
	\end{figure}

	% TOPVIEW UWturb
	\begin{figure}
		\centering
		\includegraphics[width=0.94\textwidth]{chapters/optimal_induction_control/sideview_uw.eps}
		\caption{Sideview of turbulent top-down transport of axial momentum $- \overline{\widetilde{u}_x'\widetilde{u}_z'}$ in turbine centerline plane. \emph{a) } Reference case R. \emph{b) - e)} Difference between indicated optimal control cases and reference case, defined as $\Delta = (- \overline{\widetilde{u}_x'\widetilde{u}_z'})_{\text{opt}} - (- \overline{\widetilde{u}_x'\widetilde{u}_z'})_{\text{R}}$  \label{fig:opt_ind_top_u}}
	\end{figure}	
 

Figure \ref{fig:axialvelocity} shows time-averaged axial velocities throughout the wind farm. Figure \ref{fig:axialvelocity}a illustrates the axial velocity for the reference case. It can be seen that downstream turbines are subjected to the wakes of their upstream neighbors, and that wake behavior, i.e. spanwise wake extent and wake recovery, achieves a fully-developed regime in the downstream rows of the wind farm. Figures \ref{fig:axialvelocity}b - \ref{fig:axialvelocity}d depict the difference between axial velocities in the optimized case and the reference case for cases C3t0, C3t30 and C2t0 respectively. It is shown that, for all cases, rows 2 to 12 are subjected to higher incoming velocities. For the overinductive cases C3t0 and C3t30, it can be seen that the near wake behind some turbines is deeper, yet the wake recovers more than in the reference case before reaching the next row. This is caused by enhanced turbulent wake mixing, consistent with observed increased turbulence intensities for downstream rows in these cases (not shown here). Contrastingly, the underinductive case C2t0 features higher axial velocities throughout the entire wind farm. Considering the comparable power gains of 10\% for C3t30 and C2t0, this indicates that different cases are characterized by complex different mechanisms for power increase. These are not further elaborated here, and are subject of current work. Ongoing research focusses on identifying the physical mechanisms behind the increase in energy extraction and the identification of possible correlations between turbines.   





%Horizontal transport of streamwise momentum \commwim{COMPLETE THIS PARAGRAPH}
%
%%------------------------------------------
%% Figure horizontal transport
%%------------------------------------------
%\begin{figure}
%	\includegraphics[width=\textwidth]{chapters/philtrans_torque/u1u2.eps}
%	\caption{Sideways transport of streamwise momentum $F_y$ averaged over rotor side tips ($z = z_h, y = y_h \pm D/2$) as a function of streamwise distance along turbine column. Positive values indicate centerline-oriented transport. Results are averaged over all turbine columns. Vertical dashed gray lines indicate turbine locations. \emph{Left:} $C_T'^{max} = 3$. \emph{Right:} $C_T'^{max} = 2$. \emph{Top: } Turbulent transport $F_{y,turb} = \overline{\tilde{u}_1' \tilde{u}_2'}$ . \emph{Bottom: } Mean transport $F_{y,mean} = \overline{\tilde{u}_1}\ \overline{\tilde{u}_2}$. \legendtauref
%		\label{fig:u1u2}}
%\end{figure}

%Downwards vertical transport of streamwise momentum at the top of the windfarm ($z = z_h + D/2$) is illustrated in Figure \ref{fig:u1u3}. Figure \ref{fig:u1u3}a and \ref{fig:u1u3}b show turbulent transport $F_{z, turb}^{top} = - \overline{\tilde{u}_1' \tilde{u}_3'}$, while Figure \ref{fig:u1u3}c and \ref{fig:u1u3}d contain mean vertical transport $F_{z,mean}^{top} = - \overline{\tilde{u}_1}\  \overline{\tilde{u}_3}$. It can be seen that, for cases with $C_T'^{max} = 3$, both turbulent and mean vertical transport of streamwise momentum are enhanced throughout the entire wind farm by the dynamic induction control. For the cases with $C_T'^{max} = 2$ on the other hand, turbulent transport is only slightly higher roughly up until row 6. In addition, there is no significant net gain in mean transport. The same story holds for horizontal transport of streamwise momentum, which is not shown here for brevity. 
%
%%------------------------------------------
%% Figure vertical transport
%%%------------------------------------------
%\begin{figure}
%	\includegraphics[trim={0cm, 0.5cm, 0cm, 0.4cm}, clip, width=\textwidth]{chapters/philtrans_torque/u1u3.eps}
%	\caption{Vertical top-down transport of streamwise momentum at rotor top tip ($z = z_{h} + D/2, y = y_h$) as a function of streamwise distance. Results are averaged over all turbine columns. Vertical dashed gray lines indicate turbine locations. 
%	\emph{Top} (a,b): Turbulent transport $F_{z, turb}^{top} = - \overline{\tilde{u}_1' \tilde{u}_3'}$ . \emph{Bottom} (c,d): Mean transport $F_{z, mean}^{top} = - \overline{\tilde{u}_1}\ \overline{\tilde{u}_3}$. \emph{Left} (a,c): $C_T'^{max} = 3$. \emph{Right} (b,d): $C_T'^{max} = 2$. \legendtauref 
%		\label{fig:u1u3}}
%\end{figure}

\section{Summary}

In this work, we discuss and further elaborate on the PDE-constrained optimal control framework for dynamic induction control of wind farms introduced in Goit and Meyers \cite{goit2015optimal}. Key components of the framework are discussed in detail, and the increase in convergence rate due to the upgrade of the optimization algorithm from a nonlinear conjugate gradient method used in earlier work \cite{goit2015optimal, goit2016optimal} to a quasi-Newton L-BFGS-B method is shown. New results indicate power gains for wind farms with optimal coordinated control in the order of 8 to 21\% compared to a greedily controlled case. Simulation results show that fast variations in turbine thrust coefficients are not a prerequisite for significant gains in energy extraction. Finally, user-defined values of key parameters in the optimization approach are justified based on parameter studies. Future application of the optimization framework will focus on identifying the physical mechanisms behind the observed gains in energy extraction, and the translation of simulation-based optimal controllers with high computational costs towards practical cooperative wind farm controllers. For instance, the use of reduced order state models, e.g. based on proper orthogonal decomposition or dynamic mode decomposition, provide a possible route to real-time implementation of optimal dynamic induction controllers. Another area of interest is the use of higher-fidelity wind turbine models, such as the rotating ADM \cite{wu2011large}, the actuator sector model \cite{storey2015actuator}, or the actuator line model \cite{troldborg2008actuator, sorensen2002numerical}. Furthermore, the addition of yaw to the optimal control problem, and the inclusion of thermal stratification effects in the atmosphere are interesting topics for further research.

\todo{ABOVE = RSTA, BELWO = TORQUE, differentiate}

In this work we continue the application of optimal dynamic induction control for power maximization in LES of aligned wind farms started in earlier work \cite{goit2015optimal, goit2016optimal}. More specifically, we discuss the sensitivity of achievable gains in energy extraction with respect to wind turbine response times, with the aim of reducing detrimental effects associated with fast-varying optimized thrust coefficients obtained by the latter studies. We consider simulation cases restricted to underinduction, as well as cases that also allow overinduction. In summary, the results obtained in this work show that cooperative wind farm control still yields significant power gains after eliminating potentially structurally harmful characteristics of the dynamic control schemes, i.e. strong temporal variations and large thrust forces. For instance, cases C3t30 and C2t5 show increases in energy extraction compared to greedy control strategies of 8 and 10\% respectively, which would still involve very significant economic profits. Spectral analysis of thrust forces on a wind turbine indicate the need for multi-physics optimization to accurately model additional fatigue loading and avoid the resonance excitation of deformation modes. Near-future work will focus on identifying the main mechanisms behind the observed increases in energy extraction, and translating the computationally expensive optimal controller to practical suboptimal control schemes. 
